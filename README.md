# Spring Data JDBC how to examples
collection of how to example to show how to implement specific UC

### Guides
The following project illustrate how to use some features concretely:

* [Spring Data JDBC documentation](https://docs.spring.io/spring-data/relational/reference/jdbc.html)

## package: it.spaghettisource.springdatajdbc.howto.idStrategy
the scope of this package is to show how to use the standard repository to interact with flat entity (no inner beans) and use it 
to show the different strategies applicable to manage the ID for the aggregate ROOT and show the Entity State Detection Strategies:

* how to use the DB to automatically generate the entity's id
* how to create manually the entity's id by the application for NEW entity instead that rely on the DB's ID auto generated
* how to determine by the application if execute and INSERT or an UPDATE and the manage manually the ID
* how the versioning drive the INSERT or an UPDATE of an entity

this example analyze the main aspects described in the official documentation
* [ID Generation](https://docs.spring.io/spring-data/relational/reference/jdbc/entity-persistence.html#entity-persistence.id-generation) 
* [Entity State Detection Strategies](https://docs.spring.io/spring-data/relational/reference/repositories/core-concepts.html#is-new-state-detection)


The detection strategy defined in the documentation"Providing a custom EntityInformation implementation" is not analyzed in this examples

### test: SimpleCrudAutoIdTest

a simple case that show how to create a flat entity and create the related repository.
The interaction with the repository is based on the default method automatically generated.
In this example the ID of the entity are generated automatically by the DB 

### test: SimpleCrudTestsManualIdByCallBackTest

this example show how generate the ID of the entity by application code for the NEW entity. 
It uses the BeforeConvertCallback to generate the ID.  
By this solution it is still Spring that is responsible to determine if execute INSERT or UPDATE

### test: SimpleCrudTestsManualIdByPersistableInterfaceTest

Using the Persistable interface we leverage Spring-Data from the responsibility to determine if execute INSERT or UPDATE
Then we can set manually the ID of the entity and force Spring Data to do an INSERT instead that an UPDATE

Important Note to remember: Properties of Persistable will get detected and persisted if you use AccessType.PROPERTY. To avoid that, use @Transient.

### test: SimpleCrudVersionedTest

Despite the @Version annotation it is not used strictly related to the ID generation, if effect the behaviour of Spring-Data. 
In fact when an Entity has a field annotated wit @Version, 
Spring determine if execute INSERT or UPDATE not more over an ID but it is driven by the Version attribute,
This example has the scope to make it in practise and show the behaviour under this condition. 
To keep the test simple, it used the ID autogenerated.

Important Note to remember: Is it possible exploit all the power of Spring combining strategy's together, 
for example using the @Version annotation and implementing Persistable in the way to drive when to make INSERT or UPDATE



## package: it.spaghettisource.springdatajdbc.howto.createRepository

the scope of this package is to show how to use the feature exposed by Spring Data to create, 
use and extend the functionality of the repository

* how to use the paging and sorting
* how to customize a repository extending its functionality

this example analyze the main aspects described in the official documentation
* [Defining Repository Interfaces](https://docs.spring.io/spring-data/relational/reference/repositories/definition.html)
* [Creating Repository Instances](https://docs.spring.io/spring-data/relational/reference/repositories/create-instances.html) 
* [Custom Repository Implementations](https://docs.spring.io/spring-data/relational/reference/repositories/custom-implementations.html)

### test: PageableAndSortableTest

a simple test that explore the functionality of paging and sorting exposed by the interface ListPagingAndSortingRepository
or by the Query Methods of the CrudRepository

### test: CustomRepositoryTest

This test show the capacity of Spring Data to Extend a Repository using the fragment interfaces.
In this example we use the extension of the repository to create a generic Insert method that at low level use the 
[JdbcAggregateTemplate](https://docs.spring.io/spring-data/jdbc/docs/current/api/org/springframework/data/jdbc/core/JdbcAggregateTemplate.html), 
This permit to control the behaviour of the repository forcing INSERT or UPDATE and skip the Entity State Detection Strategies logic exposed by Spring Data JBDC.

Important Note to remember: The implementation of the JdbcAggregateTemplate in case of an INSERT if the Aggregate support the 
@Version annotation set automatically the value 0 interdependently by the value that you set in the code, this can be show simply modify 
this aggregate and add to it the @Version property.


